\section{TAD \tadNombre{Juego}}

\begin{tad}{\tadNombre{Juego}}
\tadGeneros{Juego}


	\tadGeneradores
	\tadOperacion{crear}{ nat/lat, nat/long }{nat}{$lat > 0 \wedge long > 0$}
    \tadOperacion{empezarJuego}{mapa}{juego}{}
    \tadOperacion{agregarJugador}{juego/g, jugador/j}{juego}{$j \notin jugadores(g) \wedge j \notin jugadoresBanneados(g)$}

    \tadOperacion{agregarPokemon}{juego/g, pokemon p, coordenada/c}{juego}{$c \in todasCoordenadas(mapa(g)) \wedge ( \forall p': pokemon, p' \in pokemonesLibres(g))(distancia(c, obtener(p', pokemonesLibres(g)) > 5) \wedge \neg def?(p, pokemonesLibres(g))$}

    \tadOperacion{moverJugador}{juego/g,jugador/j, coordenada/c}{juego}{$c \in todasCoordenadas(mapa(g)) \wedge j \in jugadores(g)$}

    \tadOperacion{conectar}{juego/g, jugador/j, coordenada/c }{juego}{$j \in jugadores(g) \wedge \neg conectado?(j, g) \wedge c \in todasCoordenadas(mapa(g)) $}

    \tadOperacion{desconectar}{juego/g, jugador/j }{juego}{$j \in jugadores(g) \wedge conectado?(j, g)$}


\tadObservadores
    \tadOperacion{jugadores}{juego}{dicc(jugador, coordenada)}{}
    \tadOperacion{jugadoresBanneados}{juego}{conj(jugador)}{}

    \tadOperacion{conectado?}{juego/g, jugador/j}{bool}{$j \in jugadores(g)$}

    \tadOperacion{pokemonesLibres}{juego}{dicc(pokemon, coordenada)}{}
    \tadOperacion{pokemonesCapturados}{juego}{dicc(jugador, conj(pokemon))}{}
    \tadOperacion{mapa}{juego}{mapa}{}

	\tadOperacion{sanciones}{juego/g, jugador/j}{nat}{$j \in jugadores(g)$}
	
	\tadOperacion{ultimos10Movimientos}{juego/g}{secu(jugador, coordenada)}{}


\tadOtrasOperaciones
	\tadOperacion{jugadoresAlRededorPokemon}{juego/g, pokemon p}{conj(jugadores)}{def?(p, pokemonesLibres(g))}
	\tadOperacion{filtrarJugadoresAlRededor}{juego/g, pokemon p, conj(jugadores))}{conj(jugadores)}{}
	
	

	\tadOperacion{pokemonCoordenada}{juego/g, pokemon p}{coordenada}{}
	\tadOperacion{pokemones}{mapa}{conj((pokemon, coordenada))}{}

    \tadOperacion{pokemonRareza}{juego/g, pokemon p}{nat}{$p \in poketotal(j)$}
	\tadOperacion{PokeTotales}{Juego j}{multiconj(Pokemons)}{}
	\tadOperacion{movimientoValido}{mapa m, coords c1, coords c2}{bool}{}
	
	\tadOperacion{darVuelta}{dict(pokemon, coordenada)}{dict(coordenada, pokemon)}{}

	\tadOperacion{borrarPokemones}{conj(pokemon), dict(pokemon, coordenada)}{dict(pokemon, coordena)}{}
	\tadOperacion{pokemonesAAtrapar}{juego/g, conj(pokemon) ps, secu(jugador, coordenada) m}{conj(pokemon)}{}
	\tadOperacion{filtrarMovimientos}{secu(jugador, coordenada), coordenadas}{nat}{}

\tadAxiomas[\paratodo{Juego}{g}, \paratodo{Pokemon}{p}, \paratodo{Jugador}{j}]
	\tadAxioma{jugadoresAlRededorPokemon(g, p)}{filtrarJugadoresAlRededor(g, p, claves(jugadores(g)))}

    \tadAxioma{filtrarJugadoresAlRededor(g, p, js)}{$
    if \emptyset ?(js) then
    		\emptyset
    else
    			if distancia?(obtener(p, pokemonesLibres(g)), obtener(dameUno(js), jugadores(g))) \leq 2 then
    				dameUno(js) \bigcup filtrarJugadoresAlRededor(g, p, sinUno(js))
    			else
    				filtrarJugadoresAlRededor(g, p, sinUno(js))
    			fi
    	fi
    	$}
    	
    	\tadAxioma{darVuelta(di)}{$
    		if \emptyset ?(claves(di))
    		then vacio
    		else
    			definir(
    				obtener(dameUno(claves(di), di),
    				dameUno(claves(di)),
    				darVuelta(borrar(dameUno(claves(di), di))
    			)
    		fi
    	$}
    	
    	
    	
    	
    	
    	
    	\tadAxioma{pokemonesLibres(empezarJuego())}{$\emptyset$}
    	\tadAxioma{pokemonesLibres(agregarJugador(g, j))}{pokemonesLibres(g)}
    	\tadAxioma{pokemonesLibres(agregarPokemon(g, p, c))}{definir(p, c, pokemonesLibres(g)}
    	\tadAxioma{pokemonesLibres(conectar(g, p, c))}{pokemonesLibres(g)}
    	\tadAxioma{pokemonesLibres(desconectar(g, p))}{pokemonesLibres(g)}
    	\tadAxioma{pokemonesLibres(moverJugador(g, j, c))} {$
		if \neg \emptyset ?pokemoneAAtrapar(g, claves(pokemonesLibres(g)), fin(ultimos10Movimientos(g)) \circ <j, c>)
			borrarPokemones(pokemonesAAtrapar(g, claves(pokemonesLibres(g)), fin(ultimos10Movimientos(g)) \circ <j, c>), pokemonesLibres(g))
		else
			pokemonesLibres(g)
		fi
    	$}
    	
    	% axiliares para pokemonesLibres
    	\tadAxioma{pokemonesAAtrapar(g, conj\_pokemones, movimientos)}{$
		if \emptyset ?(conj\_pokemones) then
			\emptyset
		else
			if filtrarMovimientos(movimientos, obtener(dameUno(conj\_pokemones), pokemonesLibres(g)) \geq 10 \wedge jugadoresAlRededorPokemon(g, dameUno(conj\_pokemones)) \neq \emptyset then
				Ag(dameUno(conj\_pokemones), pokemonesAAtrapar(g, sinUno(conj\_pokemones), movimientos)
			else
				pokemonesAAtrapar(g, sinUno(conj\_pokemones), movimientos)
			fi
		fi
    	$}
    	
    	\tadAxioma{filtrarMovimientos(s, coord)}{$
		if vacia?(s) then
			0
		else
			if distancia({\pi}_2(prim(s)), coord) > 2 then
				1 + filtrarMovimientos(fin(s), coord)
			else
				filtrarMovimientos(fin(s), coord)
			fi
		fi
    	$}
    	
    	\tadAxioma{borrarPokemones(conj\_pokemones, dic\_poke\_coord)}{$
		if \emptyset ?(conj\_pokemones) then
			dic\_poke\_coord
		else
			if def?(dameUno(conj\_pokemones), dic\_poke\_coord) then
				borrarPokemones(sinUno(conj\_pokemones), borrar(dameUno(conj\_pokemones), dic\_poke\_coord))
			else
				borrarPokemones(sinUno(conj\_pokemones), dic\_poke\_coord)
			fi
		fi
    	$}
    	% fin auxiliares
    	
    	
    
    \tadAxioma{jugadoresBanneados(empezarJuego(m))}{[]}
    \tadAxioma{jugadoresBanneados(agregarJugador(j,j'))}{jugadoresBanneados(j')}
    \tadAxioma{jugadoresBanneados(agregarPoke(p,c,j))}{jugadoresBanneados(j')}
    \tadAxioma{jugadoresBanneados(MoverJugador(j,j',c))}{$if movimientoValido(coords(j),c) then jugadoresBanneados(j') \newline
													else if infracciones(j') <= 4 then jugadoresBanneados(j') \newline
													else jugadoresBanneados(j') \cup nombre(j)$}
    \tadAxioma{jugadoresBanneados(capturar(j,j',p))}{jugadoresBanneados(j')}
    \tadAxioma{jugadoresBanneados(conectar(j,j'))}{jugadoresBanneados(j')}
    \tadAxioma{jugadoresBanneados(desconectar(j,j'))}{jugadoresBanneados(j')}
%
%	$ \newline $
%    \tadAxioma{jugadores(empezarJuego(m))}{0}
%    \tadAxioma{jugadores(agregarJugador(j,j'))}{1234}
%    \tadAxioma{jugadores(agregarPoke(p,c,j))}{1234}
%    \tadAxioma{jugadores(MoverJugador(j,j',c))}{1234}
%    \tadAxioma{jugadores(capturar(j,j',p))}{1234}
%    \tadAxioma{jugadores(conectar(j,j'))}{1234}
%    \tadAxioma{jugadores(desconectar(j,j'))}{1234}
%
%	$ \newline $
%    \tadAxioma{PokeLibres(empezarJuego(m))}{1234}
%    \tadAxioma{PokeLibres(agregarJugador(j,j'))}{1234}
%    \tadAxioma{PokeLibres(agregarPoke(p,c,j))}{1234}
%    \tadAxioma{PokeLibres(MoverJugador(j,j',c))}{1234}
%    \tadAxioma{PokeLibres(capturar(j,j',p))}{1234}
%    \tadAxioma{PokeLibres(conectar(j,j'))}{1234}
%    \tadAxioma{PokeLibres(desconectar(j,j'))}{1234}
%
%	$ \newline $
%    \tadAxioma{PokeCapturados(empezarJuego(m))}{1234}
%    \tadAxioma{PokeCapturados(agregarJugador(j,j'))}{1234}
%    \tadAxioma{PokeCapturados(agregarPoke(p,c,j))}{1234}
%    \tadAxioma{PokeCapturados(MoverJugador(j,j',c))}{1234}
%    \tadAxioma{PokeCapturados(capturar(j,j',p))}{1234}
%    \tadAxioma{PokeCapturados(conectar(j,j'))}{1234}
%    \tadAxioma{PokeCapturados(desconectar(j,j'))}{1234}
%
%    \tadAxioma{obs(empezarJuego(m))}{1234}
%    \tadAxioma{obs(agregarJugador(j,j'))}{1234}
%    \tadAxioma{obs(agregarPoke(p,c,j))}{1234}
%    \tadAxioma{obs(MoverJugador(j,j',c))}{1234}
%    \tadAxioma{obs(capturar(j,j',p))}{1234}
%    \tadAxioma{obs(conectar(j,j'))}{1234}
%    \tadAxioma{obs(desconectar(j,j'))}{1234}
%    \singlespacing
\end{tad}
