\section{TAD \tadNombre{Juego}}

\begin{tad}{\tadNombre{Juego}}
\tadGeneros{Juego}
\tadExporta{observadores basicos, generadores y otras operaciones}


	\tadGeneradores

    \tadOperacion{empezarJuego}{mapa}{juego}{}
    \tadOperacion{agregarJugador}{juego/g, jugador/j}{juego}{$j \notin jugadores(g) \wedge j \notin jugadoresBanneados(g)$}

    \tadOperacion{agregarPokemon}{juego/g, pokemon/p, coordenada/c}{juego}{c $\in$ todasCoordenadas(mapa(g)) $\wedge$ ($\forall$ p': pokemon, p' $\in pokemonesLibres(g)$)(distancia(c, obtener(p', pokemonesLibres(g)) $>$ 5) $\wedge$ $\neg$ def?(p, pokemonesLibres(g))}

    \tadOperacion{moverJugador}{juego/g,jugador/j, coordenada/c}{juego}{$c \in todasCoordenadas(mapa(g)) \wedge j \in jugadores(g) \wedge conectado?(g, j)$}

    \tadOperacion{conectar}{juego/g, jugador/j, coordenada/c }{juego}{$j \in jugadores(g) \wedge \neg conectado?(j, g) \wedge c \in todasCoordenadas(mapa(g)) $}

    \tadOperacion{desconectar}{juego/g, jugador/j }{juego}{$j \in jugadores(g) \wedge conectado?(j, g)$}


\tadObservadores
    \tadOperacion{jugadores}{juego}{conj(jugador)}{}
    \tadOperacion{jugadoresBanneados}{juego}{conj(jugador)}{}
\tadOperacion{posActualJugador}{juego/g,jugador/j}{coordenada}{$j \in jugadores(g)$}    



    \tadOperacion{conectado?}{juego/g, jugador/j}{bool}{$j \in jugadores(g)$}

    \tadOperacion{pokemonesLibres}{juego}{dicc(pokemon, coordenada)}{}
    \tadOperacion{pokemonesCapturados}{juego}{dicc(jugador, conj(pokemon))}{}
    \tadOperacion{mapa}{juego}{mapa}{}

	\tadOperacion{sanciones}{juego/g, jugador/j}{nat}{$j \in jugadores(g)$}
	
	\tadOperacion{ultimos10Movimientos}{juego/g}{secu(jugador, coordenada)}{}


\tadOtrasOperaciones
	\tadOperacion{jugadoresAlRededorPokemon}{Juego/g, pokemon/p}{conj(jugadores)}{def?(p, pokemonesLibres(g))}
	\tadOperacion{filtrarJugadoresAlRededor}{Juego/g, pokemon/p, conj(jugadores)}{conj(jugadores)}{}

	\tadOperacion{pokemonCoordenada}{Juego/g, pokemon/p}{coordenada}{}
	\tadOperacion{pokemones}{mapa}{conj((pokemon, coordenada))}{}

    \tadOperacion{pokemonRareza}{juego/g, pokemon/p}{nat}{$p \in poketotal(g)$}
	\tadOperacion{pokemonesTotales}{Juego/j}{multiconj(Pokemons)}{}
	\tadOperacion{movimientoValido}{mapa/m, coords/c1, coords/c2}{bool}{}
	
	\tadOperacion{darVuelta}{dict(pokemon, coordenada)}{dict(coordenada, pokemon)}{}

	\tadOperacion{borrarPokemones}{conj(pokemon), dict(pokemon, coordenada)}{dict(pokemon, coordena)}{}
	\tadOperacion{pokemonesAAtrapar}{juego/g, conj(pokemon)/ps, secu(jugador, coordenada)/m}{conj(pokemon)}{}
	\tadOperacion{filtrarMovimientos}{secu(jugador, coordenada), coordenadas}{nat}{}
	\tadOperacion{estaEnInfraccion}{Juego/g, jugador/j, coordenada/c}{bool}{j $\in$ jugadores(g) $\wedge$ c $\in$ todasCoordenadas(mapa(g))}

\tadAxiomas[\paratodo{Juego}{g}, \paratodo{Pokemon}{p}, \paratodo{Jugador}{j, j'}, \paratodo{conj(Jugador)}{js}, \paratodo{Coordenada}{c}]
	\tadAxioma{jugadores(empezarJuego(m))}{$\emptyset$}
	\tadAxioma{jugadores(agregarJugador(g, j))}{Ag(j, jugadores(g))}
	\tadAxioma{jugadores(agregarPokemon(g, p, c))}{jugadores(g)}
	\tadAxioma{jugadores(moverJugador(g, j, c))}{\IF\ $(sanciones(g, j)+\beta(estaEnInfraccion(g, j, c)) \geq 5)$ THEN jugadores(g) - $\{j\}$ ELSE jugadores(g) FI}
	\tadAxioma{jugadores(conectar(g , j, c))}{jugadores(g)}
	\tadAxioma{jugadores(desconectar(g, j))}{jugadores(g)}
	
	  
    \tadAxioma{jugadoresBanneados(empezarJuego(m))}{$\emptyset$}
    \tadAxioma{jugadoresBanneados(agregarJugador(g,j))}{jugadoresBanneados(g)}
    \tadAxioma{jugadoresBanneados(agregarPokemon(g, j, c))}{jugadoresBanneados(g)}
    \tadAxioma{jugadoresBanneados(moverJugador(g, j, c))}{\IF\ $(sanciones(g, j)+\beta(estaEnInfraccion(g, j, c)) \geq 5)$ THEN Ag(j, jugadoresBanneados(g)) ELSE jugadoresBanneados(g) FI}
    \tadAxioma{jugadoresBanneados(conectar(g, j, c))}{jugadoresBanneados(g)}
    \tadAxioma{jugadoresBanneados(desconectar(g, j))}{jugadoresBanneados(g)}
	
	\tadAxioma{posActualJugador(agregarPokemon(g, p, c), j)}{posActualJugador(g, j)}
	\tadAxioma{posActualJugador(moverJugador(g, j', c), j)}{\IF\ j=j' THEN c ELSE posActualJugador(g, j) FI}
	\tadAxioma{posActualJugador(conectar(g, j', c), j)}{\IF\ j=j' THEN c ELSE posActualJugador(g, j) FI}
	\tadAxioma{posActualJugador(desconectar(g, j'), j)}{posActualJugador(g, j)}
	
	\tadAxioma{conectado?(agregarPokemon(g, p, c), j)}{conectado?(g, j)}
	\tadAxioma{conectado?(moverJugador(g, j', c), j)}{conectado?(g, j)}
	\tadAxioma{conectado?(conectar(g, j', c), j)}{\IF\ j=j' THEN true ELSE conectado?(g, j) FI}
	\tadAxioma{conectado?(desconectar(g, j), j')}{\IF\ j=j' THEN false ELSE conectado?(g, j) FI}	
	
	\tadAxioma{mapa(empezarJuego(m))}{m}
	\tadAxioma{mapa(agregarJugador(g, j))}{mapa(g)}
	\tadAxioma{mapa(agregarPokemon(g, p, c))}{mapa(g)}
	\tadAxioma{mapa(moverJugador(g, j, c))}{mapa(g)}
	\tadAxioma{mapa(conectar(g, j, c))}{mapa(g)}
	\tadAxioma{mapa(desconectar(g, j))}{mapa(g)}
	
	\tadAxioma{ultimos10Movimientos(empezarJuego(m))}{vacia}
	\tadAxioma{ultimos10Movimientos(agregarJugador(g, j))}{ultimos10Movimientos(g)}
	\tadAxioma{ultimos10Movimientos(agregarPokemon(g, p, c))}{ultimos10Movimientos(g)}

	\tadAxioma{ultimos10Movimientos(moverJugador(g, j, c))}{
		\IF $long(ultimos10Movimientos(g)) < 10$ THEN
			ultimos10Movimientos(g) $\argumento$ <j, c>
		ELSE
			fin(ultimos10Movimientos(g)) $\argumento$ <j, c>
		FI
		}

	\tadAxioma{ultimos10Movimientos(conectar(g, j, c))}{
		\IF $long(ultimos10Movimientos(g)) < 10$ THEN
			ultimos10Movimientos(g) $\argumento$ <j, c> 
		ELSE 
			fin(ultimos10Movimientos(g)) $\argumento$ <j, c>
		FI
		}
	\tadAxioma{ultimos10Movimientos(desconectar(g, j))}{ultimos10Movimientos(g)}
		
	\tadAxioma{sanciones(aregarPokemon(g, p, c), j)}{sanciones(g, j)}
	\tadAxioma{sanciones(moverJugador(g, j', c), j)}{\IF\ $j \neq j'$ THEN sanciones(g, j) ELSE {\IF\ estaEnInfraccion(g, j, c) THEN 1 + sanciones(g, j)%
ELSE sanciones(g, j) FI} FI}
	\tadAxioma{sanciones(conectar(g, j', c), j)}{sanciones(g, j)}
	\tadAxioma{sanciones(desconectar(g, j'), j)}{sanciones(g, j)}

	\tadAxioma{jugadoresAlRededorPokemon(g, p)}{filtrarJugadoresAlRededor(g, p, claves(jugadores(g)))}
    \tadAxioma{filtrarJugadoresAlRededor(g, p, js)}{%
    \IF\ $\emptyset?(js)$ THEN $\emptyset$ ELSE %
    		{\IF\ (distancia?( \newline
				obtener(p, pokemonesLibres(g)), \newline 
				obtener(dameUno(js), jugadores(g))) $\leq$ 2) THEN dameUno(js) $\bigcup$ filtrarJugadoresAlRededor(g, p, sinUno(js))
ELSE filtrarJugadoresAlRededor(g, p, sinUno(js)) FI}%
	FI}
    \tadAxioma{darVuelta(di)}{%
    		\IF\ $\emptyset$?(claves(di)) THEN vacio %
    		ELSE definir(obtener(dameUno(claves(di), di), dameUno(claves(di)), darVuelta(borrar(dameUno(claves(di), di))) %
	    	FI%
    	}
    \tadAxioma{pokemonesLibres(empezarJuego())}{$\emptyset$}
    \tadAxioma{pokemonesLibres(agregarJugador(g, j))}{pokemonesLibres(g)}
    \tadAxioma{pokemonesLibres(agregarPokemon(g, p, c))}{definir(p, c, pokemonesLibres(g))}
    \tadAxioma{pokemonesLibres(conectar(g, p, c))}{pokemonesLibres(g)}
    \tadAxioma{pokemonesLibres(desconectar(g, p))}{pokemonesLibres(g)}
    \tadAxioma{pokemonesLibres(moverJugador(g, j, c))}{
		\IF\ $\neg\emptyset?$ pokemonesAAtrapar(g, claves(pokemonesLibres(g)), \newline fin(ultimos10Movimientos(g)) \argumento <j, c>) THEN
			{borrarPokemones(pokemonesAAtrapar(g, \newline claves(pokemonesLibres(g)), fin(ultimos10Movimientos(g)) \argumento <j, c>), pokemonesLibres(g))} 
		ELSE
			pokemonesLibres(g)
		FI}

	\tadAxioma{estaEnInfraccion(g, j, c)}{(distancia(c, posActualJugador(g, j))$\geqslant$ 10) $\vee$ $\neg$(hayCamino(c, posActualJugador(g, j), mapa(g)))}
    	
    	% axiliares para pokemonesLibres
    \tadAxioma{pokemonesAAtrapar(g, cpoke, movimientos)}{
    		\IF\ $\emptyset?(cpoke)$ THEN
    			$\emptyset$
    		ELSE 
    			{\IF\ $filtrarMovimientos(movimientos, obtener(dameUno(cpoke), pokemonesLibres(g)) \geq 10 \wedge jugadoresAlRededorPokemon(g, dameUno(cpoke)) \neq \emptyset$ THEN
    				Ag(dameUno(cpoke), pokemonesAAtrapar(g, sinUno(cpoke), movimientos)
    			ELSE
    				pokemonesAAtrapar(g, sinUno(cpoke), movimientos)
    			FI} 
    		FI
    }
    \tadAxioma{filtrarMovimientos(s, coord)}{\IF\ vacia?(s) THEN 0 ELSE {\IF\ distancia($\pi_2$(prim(s)), coord) $>$ 2 THEN 1 + filtrarMovimientos(fin(s), coord) ELSE filtrarMovimientos(fin(s), coord) FI} FI}
    \tadAxioma{borrarPokemones(conj\_pokemones, dic\_poke\_coord)}{\IF\ $\emptyset$?(conj\_pokemones) THEN dic\_poke\_coord ELSE %
{\IF\ def?(dameUno(conj\_pokemones), dic\_poke\_coord) THEN borrarPokemones(sinUno(conj\_pokemones), borrar(dameUno(conj\_pokemones), dic\_poke\_coord)) ELSE borrarPokemones(sinUno(conj\_pokemones), dic\_poke\_coord) FI} FI}
    	% fin auxiliares
    	
    	
  

\end{tad}
